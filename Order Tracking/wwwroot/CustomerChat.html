<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Customer Chat</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.5/signalr.min.js"></script>
</head>
<body>

    <h2>Customer Chat</h2>

    <div id="login">
        <input type="text" id="userIdInput" placeholder="Enter your ID">
        <button onclick="joinChat()">Join Chat</button>
    </div>

    <div id="chatBox" style="display:none;">
        <div id="messages" style="border:1px solid #ccc; height:200px; overflow:auto; padding:10px;"></div>

        <br>

        <input type="text" id="msgInput" placeholder="Write a message...">
        <button onclick="sendMessage()">Send</button>
    </div>

    <script>
        let connection;

        async function joinChat() {
            const userId = document.getElementById("userIdInput").value;

            if (!userId) {
                alert("Please enter an ID");
                return;
            }
           connection = new signalR.HubConnectionBuilder()
               .with("/ChatHub")
               .build();


            connection.on("ReceiveMessage", (message) => {
                const box = document.getElementById("messages");
                box.innerHTML += `<div><b>Support:</b> ${message}</div>`;
            });

            await connection.start();

            await connection.invoke("JoinGroup", userId);

            document.getElementById("login").style.display = "none";
            document.getElementById("chatBox").style.display = "block";
        }

        async function sendMessage() {
            const msg = document.getElementById("msgInput").value;

            if (!msg) return;

            document.getElementById("messages").innerHTML += `<div><b>You:</b> ${msg}</div>`;
            document.getElementById("msgInput").value = "";

            // هنبعتها للموظف (لسه هنجهز API / hub method للارسال)
            await connection.invoke("SendMessageToSupport", msg);
        }
    </script>

</body>
</html>
